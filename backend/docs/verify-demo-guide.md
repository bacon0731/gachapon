# 殺率調整驗證演示指南

## 概述

這個演示頁面用於驗證「分離驗證機制」的核心原理：**即使過程中調整殺率，玩家驗證時哈希值仍然一致**。

## 訪問路徑

管理後台：`/test/verify-demo`

## 使用步驟

### 1. 生成測試數據

1. 點擊「生成 Seed」按鈕，自動生成一個隨機種子
2. 設定 Nonce（預設為 1，表示第 1 抽）
3. 選擇要測試的商品

### 2. 設定殺率參數

- **初始殺率**：模擬活動開始時的殺率設定（例如：1.0 = 100%）
- **調整後殺率**：模擬活動過程中調整的殺率（例如：1.5 = 150%）

### 3. 執行驗證測試

點擊「執行驗證測試」按鈕，系統會：

1. 使用相同的 Seed 和 Nonce 生成 TXID Hash
2. 使用相同的隨機數（Random Value）
3. 分別用兩個不同的殺率計算獎項
4. 顯示驗證結果

### 4. 查看驗證結果

結果頁面會顯示：

- ✅ **哈希驗證成功**：證明 TXID Hash 不因殺率改變而改變
- **隨機數**：相同的 Seed:Nonce 組合永遠產生相同的隨機數
- **獎項對比**：展示不同殺率下的獎項判定結果
- **驗證流程說明**：完整的驗證流程步驟

## 關鍵驗證點

### 1. 哈希一致性

無論殺率如何調整，只要 Seed 和 Nonce 相同，TXID Hash 就永遠相同。

```
TXID Hash = SHA256(Seed:Nonce)
```

殺率參數不包含在這個計算中，所以：
- ✅ 殺率改變 → TXID Hash 不變
- ✅ 玩家驗證 → Hash 一致

### 2. 隨機數確定性

相同的 Seed:Nonce 組合永遠產生相同的隨機數：

```
Random Value = HMAC-SHA256(Seed, Nonce)
```

這確保了：
- ✅ 驗證時可以重新計算相同的隨機數
- ✅ 獎項判定可以重現

### 3. 獎項判定差異

雖然隨機數相同，但不同的殺率會導致不同的獎項判定：

- **殺率 1.0**：使用原始機率判定
- **殺率 1.5**：使用調整後機率（原始機率 × 1.5）判定

這證明了：
- ✅ 殺率調整影響獎項判定
- ✅ 但不影響哈希驗證

## 實際應用場景

### 場景 1：活動開始後調整殺率

1. **活動開始**：公布 TXID Hash（基於 Seed:Nonce）
2. **抽獎進行中**：管理員將殺率從 1.0 調整為 1.5
3. **活動結束**：公布 Seed
4. **玩家驗證**：使用 Seed、Nonce 和預期 Hash 驗證
5. **結果**：✅ 驗證成功，Hash 一致

### 場景 2：多次調整殺率

即使過程中多次調整殺率（例如：1.0 → 1.2 → 1.5 → 0.8），只要：
- Seed 不變
- Nonce 不變

最終驗證時，TXID Hash 仍然一致。

## 技術細節

### TXID Hash 計算

```typescript
const txidString = `${seed}:${nonce}`
const txidHash = SHA256(txidString)
```

### 隨機數生成

```typescript
const randomValue = HMAC-SHA256(seed, nonce.toString())
// 轉換為 0-1 之間的浮點數
```

### 獎項判定

```typescript
// 使用調整後的機率
const adjustedProbability = originalProbability * profitRate
// 正規化後判定獎項
```

## 注意事項

1. **Seed 保密性**：活動結束前，Seed 必須保密
2. **Nonce 唯一性**：每個抽獎必須有唯一的 Nonce
3. **Hash 公開性**：TXID Hash 在活動開始時就應該公開
4. **殺率記錄**：雖然不影響驗證，但應該記錄殺率變更歷史用於審計

## 驗證流程圖

```
活動開始
  ↓
公布 TXID Hash (基於 Seed:Nonce)
  ↓
抽獎進行中
  ↓
調整殺率 (1.0 → 1.5)
  ↓
活動結束
  ↓
公布 Seed
  ↓
玩家驗證
  ├─ 輸入 Seed
  ├─ 輸入 Nonce
  └─ 輸入預期 Hash
  ↓
計算 TXID Hash
  ↓
比對結果
  └─ ✅ Hash 一致（驗證成功）
```

## 常見問題

### Q: 為什麼殺率改變不影響 Hash？

A: 因為 TXID Hash 只基於 Seed 和 Nonce，不包含殺率參數。這是「分離驗證機制」的核心設計。

### Q: 如果 Seed 洩露會怎樣？

A: 如果 Seed 在活動結束前洩露，玩家可以提前計算隨機數，但無法改變已公布的 Hash。活動結束後公布 Seed 是正常的驗證流程。

### Q: 殺率調整是否會被發現？

A: 殺率調整不會影響哈希驗證，但可以通過記錄殺率變更歷史來追蹤。這是商業機密，不需要向玩家公開。

### Q: 如何確保公平性？

A: 公平性通過以下機制保證：
1. TXID Hash 在活動開始時就公開
2. Seed 在活動結束後公開
3. 玩家可以驗證 Hash 的一致性
4. 隨機數是確定性的，可以重現
